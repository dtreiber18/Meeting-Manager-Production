<div class="meeting-details-container">
  <!-- Modal Container -->
  <app-modal-container></app-modal-container>
  
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading meeting details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <div class="error-icon">âš ï¸</div>
    <h3>Unable to Load Meeting</h3>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="retryLoad()">Try Again</button>
  </div>

  <!-- Meeting Details -->
  <div *ngIf="meeting && !loading" class="meeting-details">
    <!-- Header Section -->
    <div class="meeting-header">
      <div class="meeting-title-section">
        <h1 class="meeting-title">{{ meeting.title || meeting.subject || 'Untitled Meeting' }}</h1>
        <div class="meeting-meta">
          <span class="meeting-type">{{ meeting.meetingType || meeting.type || 'Meeting' }}</span>
          <span class="meeting-status" [class]="'status-' + ((meeting.status || 'scheduled').toLowerCase())">
            {{ meeting.status || 'Scheduled' }}
          </span>
          <span *ngIf="meeting.priority" class="meeting-priority" [class]="'priority-' + (meeting.priority.toLowerCase())">
            {{ meeting.priority }} Priority
          </span>
        </div>
      </div>
      <div class="meeting-actions">
        <button 
          type="button"
          class="action-btn edit-btn" 
          [class.editing]="isEditing"
          (click)="editMeeting($event)">
          {{ isEditing ? 'âœ… Done' : 'ğŸ“ Edit' }}
        </button>
        <button class="action-btn upload-btn" (click)="uploadDocuments()">
          ğŸ“ Upload Documents
        </button>
      </div>
    </div>

    <!-- Meeting Info Grid -->
    <div class="meeting-info-grid">
      <!-- Date & Time -->
      <div class="info-card">
        <h3>ğŸ“… Schedule</h3>
        <div class="schedule-info">
          <div class="date-time">
            <strong>Start:</strong> {{ formatDateTime(meeting.startTime || (meeting.date && meeting.time ? meeting.date + ' ' + meeting.time : undefined)) }}
          </div>
          <div *ngIf="meeting.endTime" class="date-time">
            <strong>End:</strong> {{ formatDateTime(meeting.endTime) }}
          </div>
          <div *ngIf="meeting.durationInMinutes" class="duration">
            <strong>Duration:</strong> {{ meeting.durationInMinutes }} minutes
          </div>
        </div>
      </div>

      <!-- Location -->
      <div class="info-card" *ngIf="meeting.location || meeting.meetingLink">
        <h3>ğŸ“ Location</h3>
        <div class="location-info">
          <div *ngIf="meeting.location" class="location">
            {{ meeting.location }}
          </div>
          <div *ngIf="meeting.meetingLink" class="meeting-link">
            <a [href]="meeting.meetingLink" target="_blank" class="link-btn">
              ğŸ”— Join Meeting
            </a>
          </div>
        </div>
      </div>

      <!-- Organizer -->
      <div class="info-card">
        <h3>ğŸ‘¤ Organizer</h3>
        <div class="organizer-info">
          <div class="organizer-name">{{ meeting.organizer ? (meeting.organizer.fullName || meeting.organizer.displayName || 'Unknown') : 'Unknown' }}</div>
          <div *ngIf="meeting.organizer?.email" class="organizer-email">{{ meeting.organizer.email }}</div>
          <div *ngIf="meeting.organizer?.jobTitle" class="organizer-title">{{ meeting.organizer.jobTitle }}</div>
        </div>
      </div>

      <!-- Recording -->
      <div class="info-card" *ngIf="meeting.recordingUrl || meeting.transcriptUrl">
        <h3>ğŸ¥ Recording</h3>
        <div class="recording-info">
          <a *ngIf="meeting.recordingUrl" [href]="meeting.recordingUrl" target="_blank" class="link-btn">
            â–¶ï¸ View Recording
          </a>
          <a *ngIf="meeting.transcriptUrl" [href]="meeting.transcriptUrl" target="_blank" class="link-btn">
            ğŸ“„ View Transcript
          </a>
        </div>
      </div>
    </div>

    <!-- Description -->
    <div class="content-section">
      <div class="section-header">
        <h3>ğŸ“‹ Description</h3>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="edit-content-btn" 
          (click)="editMeetingField('description')">
          âœï¸ Edit
        </button>
      </div>
      <div class="content-text" *ngIf="meeting.description || meeting.details">
        {{ meeting.description || meeting.details }}
      </div>
      <div class="empty-content" *ngIf="!meeting.description && !meeting.details">
        <p>No description provided.</p>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="editMeetingField('description')">
          â• Add Description
        </button>
      </div>
    </div>

    <!-- Agenda -->
    <div *ngIf="meeting.agenda" class="content-section">
      <h3>ğŸ“ Agenda</h3>
      <div class="content-text">
        {{ meeting.agenda }}
      </div>
    </div>

    <!-- Summary -->
    <div class="content-section">
      <div class="section-header">
        <h3>ğŸ“Š Summary</h3>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="edit-content-btn" 
          (click)="editMeetingField('summary')">
          âœï¸ Edit
        </button>
      </div>
      <div class="content-text" *ngIf="meeting.summary">
        {{ meeting.summary }}
      </div>
      <div class="empty-content" *ngIf="!meeting.summary">
        <p>No summary provided.</p>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="editMeetingField('summary')">
          â• Add Summary
        </button>
      </div>
    </div>

    <!-- Key Decisions -->
    <div *ngIf="meeting.keyDecisions" class="content-section">
      <h3>ğŸ¯ Key Decisions</h3>
      <div class="content-text">
        {{ meeting.keyDecisions }}
      </div>
    </div>

    <!-- Next Steps -->
    <div class="content-section">
      <div class="section-header">
        <h3>â­ï¸ Next Steps</h3>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="edit-content-btn" 
          (click)="editMeetingField('nextSteps')">
          âœï¸ Edit
        </button>
      </div>
      <div class="content-text" *ngIf="meeting.nextSteps">
        {{ meeting.nextSteps }}
      </div>
      <div class="empty-content" *ngIf="!meeting.nextSteps">
        <p>No next steps defined.</p>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="editMeetingField('nextSteps')">
          â• Add Next Steps
        </button>
      </div>
    </div>

    <!-- AI Insights -->
    <div *ngIf="meeting.aiInsights" class="content-section ai-insights">
      <h3>ğŸ¤– AI Insights</h3>
      <div class="content-text">
        {{ meeting.aiInsights }}
      </div>
    </div>

    <!-- Participants -->
    <div class="participants-section">
      <div class="section-header">
        <h3>ğŸ‘¥ Participants ({{ (meeting.participants && meeting.participants.length) || 0 }})</h3>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="addParticipant()">
          â• Add Participant
        </button>
      </div>
      
      <div *ngIf="meeting.participants && meeting.participants.length > 0" class="participants-grid">
        <div *ngFor="let participant of meeting.participants" 
             class="participant-card"
             [class.editable]="isEditing"
             (click)="isEditing ? editParticipant(participant) : null">
          <div class="participant-avatar">
            {{ getInitials(participant.name) }}
          </div>
          <div class="participant-info">
            <div class="participant-name">{{ participant.name }}</div>
            <div class="participant-email">{{ participant.email }}</div>
            <div class="participant-meta">
              <span class="participant-role">{{ participant.participantRole || 'Attendee' }}</span>
              <span class="attendance-status" [class]="'attendance-' + (participant.attendanceStatus || 'pending').toLowerCase()">
                {{ participant.attendanceStatus || (participant.attended ? 'Attended' : 'Pending') }}
              </span>
            </div>
          </div>
          <button 
            *ngIf="isEditing" 
            type="button"
            class="remove-btn"
            (click)="removeParticipant(participant); $event.stopPropagation()">
            âœ•
          </button>
          <div *ngIf="isEditing" class="edit-hint">
            Click to edit
          </div>
        </div>
      </div>
      
      <div *ngIf="!meeting.participants || meeting.participants.length === 0" class="empty-state">
        <p>No participants added yet.</p>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="addParticipant()">
          â• Add First Participant
        </button>
      </div>
    </div>

    <!-- Action Items -->
    <div class="action-items-section">
      <div class="section-header">
        <h3>âœ… Action Items ({{ (meeting.actionItems && meeting.actionItems.length) || 0 }})</h3>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="addActionItem()">
          â• Add Action Item
        </button>
      </div>
      
      <div *ngIf="meeting.actionItems && meeting.actionItems.length > 0" class="action-items-list">
        <div *ngFor="let item of meeting.actionItems" class="action-item-card">
          <div class="action-item-status">
            <div class="status-indicator" [class]="'status-' + (item.status || 'pending').toLowerCase()"></div>
          </div>
          <div class="action-item-content">
            <div class="action-item-title">{{ item.title || item.description }}</div>
            <div class="action-item-meta">
              <span class="assignee">ğŸ‘¤ {{ item.assignedTo || item.assignee?.fullName || 'Unassigned' }}</span>
              <span class="due-date">ğŸ“… {{ formatDate(item.dueDate) }}</span>
              <span class="priority" [class]="'priority-' + (item.priority || 'medium').toLowerCase()">
                {{ item.priority || 'Medium' }} Priority
              </span>
            </div>
          </div>
          <button 
            *ngIf="isEditing" 
            type="button"
            class="remove-btn"
            (click)="removeActionItem(item)">
            âœ•
          </button>
        </div>
      </div>
      
      <div *ngIf="!meeting.actionItems || meeting.actionItems.length === 0" class="empty-state">
        <p>No action items added yet.</p>
        <button 
          *ngIf="isEditing" 
          type="button"
          class="add-btn" 
          (click)="addActionItem()">
          â• Add First Action Item
        </button>
      </div>
    </div>

    <!-- Meeting Settings -->
    <div class="settings-section">
      <h3>âš™ï¸ Meeting Settings</h3>
      <div class="settings-grid">
        <div class="setting-item">
          <span class="setting-label">Recording Allowed:</span>
          <span class="setting-value">{{ meeting.allowRecording ? 'Yes' : 'No' }}</span>
        </div>
        <div class="setting-item">
          <span class="setting-label">Auto Transcription:</span>
          <span class="setting-value">{{ meeting.autoTranscription ? 'Enabled' : 'Disabled' }}</span>
        </div>
        <div class="setting-item">
          <span class="setting-label">AI Analysis:</span>
          <span class="setting-value">{{ meeting.aiAnalysisEnabled ? 'Enabled' : 'Disabled' }}</span>
        </div>
        <div class="setting-item">
          <span class="setting-label">Public Meeting:</span>
          <span class="setting-value">{{ meeting.isPublic ? 'Yes' : 'No' }}</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="meeting-footer">
      <div class="timestamps">
        <div class="timestamp">Created: {{ formatDateTime(meeting.createdAt) }}</div>
        <div class="timestamp">Last Updated: {{ formatDateTime(meeting.updatedAt) }}</div>
      </div>
    </div>
  </div>
</div>
